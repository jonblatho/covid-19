var chevron=document.getElementById("chevron"),dropdownButton=document.getElementById("dropdown-selected"),dropdownMenu=document.getElementById("dropdown-menu"),selectedChartName=document.getElementById("selected-chart-name"),newCasesButton=document.getElementById("new-cases"),riskLevelButton=document.getElementById("risk-level-chart"),totalCasesButton=document.getElementById("total-cases"),activeCasesButton=document.getElementById("active-cases"),positivityRateButton=document.getElementById("positivity-rate"),vaccineDosesButton=document.getElementById("vaccine-doses"),vaccineResidentsButton=document.getElementById("vaccine-residents"),dateMarkersButton=document.getElementById("date-markers"),activeChartType,prefersDateMarkersOn;let selectedClassName="dropdown-item-selected";activeChartType='new',prefersDateMarkersOn=!1;let width,height,riskLevelGradient;function riskLevelGradientColor(d,a){const b=a.right-a.left,c=a.bottom-a.top;if(riskLevelGradient===null||width!==b||height!==c){width=b,height=c;const l=chart.scales.y.min,k=chart.scales.y.max;if(k==1)return null;const e=k-l,j=0/e,h=1/e,i=10/e,f=25/e,g=75/e;console.log(j,h,i,f,g),riskLevelGradient=d.createLinearGradient(0,a.bottom,0,a.top),riskLevelGradient.addColorStop(j,'#43B02A'),riskLevelGradient.addColorStop(h-1e-5,'#43B02A'),riskLevelGradient.addColorStop(h,'#E0A526'),riskLevelGradient.addColorStop(i,'#E0A526'),riskLevelGradient.addColorStop(i,'#DC3513'),riskLevelGradient.addColorStop(f-1e-5,'#DC3513'),riskLevelGradient.addColorStop(f,'#8A2B2B'),riskLevelGradient.addColorStop(g-1e-5,'#8A2B2B'),riskLevelGradient.addColorStop(g,'#DF1995')}return riskLevelGradient}function showDropdownMenu(){dropdownMenu.classList.contains("hidden")?(dropdownButton.classList.add("dropdown-selected-active"),dropdownMenu.classList.remove("hidden")):(dropdownButton.classList.remove("dropdown-selected-active"),dropdownMenu.classList.add("hidden"))}function changeChart(a,b){a!='date_markers'&&(totalCasesButton.classList.remove(selectedClassName),newCasesButton.classList.remove(selectedClassName),riskLevelButton.classList.remove(selectedClassName),activeCasesButton.classList.remove(selectedClassName),positivityRateButton.classList.remove(selectedClassName),vaccineDosesButton.classList.remove(selectedClassName),vaccineResidentsButton.classList.remove(selectedClassName)),a=='total'?(selectedChartName.innerHTML='Total Cases',totalCasesButton.classList.add(selectedClassName)):a=='new'?(activeChartType='new',selectedChartName.innerHTML='New Cases',newCasesButton.classList.add(selectedClassName)):a=='risk_level'?(activeChartType='risk_level',selectedChartName.innerHTML='Risk Level',riskLevelButton.classList.add(selectedClassName)):a=='active'?(activeChartType='active',selectedChartName.innerHTML='Active Cases',activeCasesButton.classList.add(selectedClassName)):a=='pos_rate'?(activeChartType='pos_rate',selectedChartName.innerHTML='Testing',positivityRateButton.classList.add(selectedClassName)):a=='vaccine_doses'?(activeChartType='vaccine_doses',selectedChartName.innerHTML='Vaccine Doses',vaccineDosesButton.classList.add(selectedClassName)):a=='vaccine_residents'?(activeChartType='vaccine_residents',selectedChartName.innerHTML='Vaccinated Residents',vaccineResidentsButton.classList.add(selectedClassName)):a=='date_markers'&&(dateMarkersButton.classList.contains("button-selected")?dateMarkersButton.classList.remove("button-selected"):dateMarkersButton.classList.add("button-selected"),prefersDateMarkersOn==!0?(prefersDateMarkersOn=!1,removeDateMarkers()):(prefersDateMarkersOn=!0,addDateMarkers())),dropdownMenu.classList.contains("hidden")||showDropdownMenu(),a!='date_markers'?reloadChart(a,b):chart.update()}function reloadChart(a,b){chart.destroy(),a=='new'?chartType='bar':chartType='line',chart=new Chart(ctx,{type:chartType,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:'time',min:'2020-04-01',max:end_date,time:{tooltipFormat:'ddd. MMMM D, yyyy',unit:'month'}},y:{min:0,display:'auto'},y_tests:{position:'right',display:'auto',min:0,grid:{display:!1}}},grid:{offset:!0},plugins:{annotation:markers},interaction:{mode:'index',intersect:!1},animation:!1}}),chart.data.labels=chartLabels(a,b),chart.data.datasets=chartData(a,b),a=='total'||a=='new'?(chart.options.scales.x.stacked=!0,chart.options.scales.y.stacked=!0,chart.options.plugins.tooltip.callbacks.afterBody=function(a){return filteredContextItems=a.filter(a=>a.dataset.label!='7-day Average'),values=filteredContextItems.map(a=>a.raw),'Total: '+Intl.NumberFormat().format(values.reduce(function(a,b){return a+b}))}):a=='risk_level'||a=='active'||a=='pos_rate'?(chart.options.scales.x.stacked=!1,chart.options.scales.y.stacked=!1,a=='risk_level'&&(chart.data.datasets[0].borderColor=function(b){const c=b.chart,{ctx:d,chartArea:a}=c;return a?riskLevelGradientColor(d,a):null}),chart.options.plugins.tooltip.callbacks.afterBody=function(b){return a=='risk_level'?(value=b[0].raw,value<1)?'Low Risk':value<10?'Medium Risk':value<25?'High Risk':value<75?'Critical Risk':'Extreme Risk':null}):(a=='vaccine_doses'||a=='vaccine_residents')&&(console.log("Setting minimum x-axis value to 2020-12-15."),chart.options.scales={x:{type:'time',min:'2020-12-15',max:end_date,time:{tooltipFormat:'MMMM D, yyyy',unit:'month'}},y:{type:'linear',position:'left',min:0,grid:{display:!0}},y_tests:{type:'linear',position:'right',min:0,display:!1}}),a=='pos_rate'&&(chart.options.scales={x:{type:'time',min:'2020-09-02',max:end_date,time:{tooltipFormat:'MMMM D, yyyy',unit:'month'}},y:{type:'linear',position:'left',min:0,grid:{display:!0},ticks:{callback:function(a,b,c){return a=a.toString(),a=a.split(/(?=(?:...)*$)/),a+'%'}}},y_tests:{type:'linear',position:'right',min:0,grid:{display:!0}}},chart.options.plugins.tooltip={callbacks:{label:function(b){var a=b.dataset.label||'';return a&&(a+=': '),b.dataset.label=='14-day Positivity Rate'?a+=new Intl.NumberFormat('en-US',{style:'unit',unit:'percent'}).format(b.parsed.y):a+=b.parsed.y,a}}}),chart.options.scales.x.grid.offset=!1,chart.options.scales.x.grid.color='rgba(128,128,128,0.5)',chart.options.scales.x.grid.borderColor='rgba(128,128,128,0.5)',chart.options.scales.y.grid.color='rgba(128,128,128,0.5)',chart.options.scales.y.grid.borderColor='rgba(128,128,128,0.5)',chart.options.scales.y_tests.grid.display=!1,window.innerWidth>600&&prefersDateMarkersOn==!0?addDateMarkers():removeDateMarkers(),chart.update()}function addDateMarkers(){dateMarkersButton.classList.contains(selectedClassName)&&dateMarkersButton.classList.add(selectedClassName),chart.options.plugins.annotation=markers,chart.update()}function removeDateMarkers(){dateMarkersButton.classList.contains(selectedClassName)&&dateMarkersButton.classList.remove(selectedClassName),chart.options.plugins.annotation={},chart.update()}