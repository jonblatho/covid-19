{{ $date := .Site.Data.summary.last_updated }}
{{ if isset .Params "date" }}
{{ $date = .Params.date }}
{{ end }}
        </main>
        <footer>
            <div class="container-fluid">
                <p>&copy; {{ now.Format "2006"}} Jonathan Thornton &middot; <a href="https://github.com/jonblatho/covid-19/blob/main/LICENSE">MIT License</a></p>
                {{ if or .IsHome (eq .Params.layout "table") }}
                <p>Site last updated: {{ now.Format "3:04 PM MST January 2" }}</p>
                {{ end }}
                <p><a href="https://github.com/jonblatho/covid-19">View on GitHub</a> &middot; <a href="/privacy">Privacy</a></p>
                <p class="disclaimer">To the fullest extent permitted by applicable law, no warranty or guarantee is made regarding the timeliness, accuracy, or availability of the content of this webpage or updates thereto. This webpage is maintained on a best-effort, as-is basis. Data provided on this webpage are intended strictly for informational purposes; may be incorrect, incomplete, or outdated; and should not be used to make health care decisions.</p>
            </div>
        </footer>
        {{ if or (eq .Params.layout "time-machine") .IsHome }}
        <script>
            const chartContainer = document.getElementById("chart-container");
            const chartElement = document.createElement("canvas");
            chartElement.id = "chart";
            chartElement.setAttribute("aria-hidden", "true");
            chartContainer.appendChild(chartElement);
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" defer></script>
        {{ $chartJS := resources.Get "js/chart.min.js" | resources.Fingerprint "sha512" }}
        <script src="{{ $chartJS.Permalink }}" integrity="{{ $chartJS.Data.Integrity }}" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@0.1.2/dist/chartjs-adapter-moment.min.js" integrity="sha256-mJm4oz+jkEuyR3VN2HVsm8bM3cMWU7Zot+JMClIi0sY=" crossorigin="anonymous" defer></script>
        {{ $annotation := resources.Get "js/chartjs-plugin-annotation.min.js" | resources.Fingerprint "sha512" }}
        <script src="{{ $annotation.Permalink }}" integrity="{{ $annotation.Data.Integrity }}" defer></script>
        <script src="https://code.iconify.design/1/1.0.7/iconify.min.js" async defer></script>
        <script>
            var end_date = {{ dateFormat "2006-01-02" $date }};
        </script>
        {{ $data := resources.Get "js/chart-data.json" | resources.Minify }}
        {{ $dataJS := resources.Get "js/chart-data.js" | resources.Minify | resources.Fingerprint }}
        {{ $configJS := resources.Get "js/chart-config.js" | resources.Minify | resources.Fingerprint }}
        {{ $uiJS := resources.Get "js/chart-ui.js" | resources.Minify | resources.Fingerprint }}
        {{ $dateMarkersJS := resources.Get "js/chart-date-markers.js" | resources.Minify }}
        <script src="{{ $dataJS.Permalink }}" integrity="{{ $dataJS.Data.Integrity }}" defer></script>
        <script src="{{ $configJS.Permalink }}" integrity="{{ $configJS.Data.Integrity }}" defer></script>
        <script src="{{ $uiJS.Permalink }}" integrity="{{ $uiJS.Data.Integrity }}" defer></script>
        <script src="{{ $dateMarkersJS.Permalink }}" integrity="{{ $dateMarkersJS.Data.Integrity }}" defer></script>
        <script>
            var ctx = chartElement.getContext("2d");
            
            var interval = setInterval(function() {
                if(typeof(Chart) != 'undefined') {
                    window.clearInterval(interval); // Stop executing repeatedly

                    var chart = new Chart(ctx);
                    let url = '{{ $data.Permalink }}';


                    fetch(url)
                    .then(res => res.json())
                    .then((out) => {
                        json = out
                        reloadChart(chart, 'new', json);
                    })
                    .catch(err => { throw err } );
                }
            }, 10);

            

            document.addEventListener("DOMContentLoaded", function() {
                window.setInterval(interval);
            });
        </script>
        {{ end }}
    </body>
</html>